var jsPsychVideoButtonResponse=function(r){"use strict";var g="2.1.0";const T={name:"video-button-response",version:g,parameters:{stimulus:{type:r.ParameterType.VIDEO,default:void 0,array:!0},choices:{type:r.ParameterType.STRING,default:void 0,array:!0},button_html:{type:r.ParameterType.FUNCTION,default:function(_,n){return`<button class="jspsych-btn">${_}</button>`}},prompt:{type:r.ParameterType.HTML_STRING,default:null},width:{type:r.ParameterType.INT,default:""},height:{type:r.ParameterType.INT,default:""},autoplay:{type:r.ParameterType.BOOL,pretty_name:"Autoplay",default:!0},controls:{type:r.ParameterType.BOOL,default:!1},start:{type:r.ParameterType.FLOAT,default:null},stop:{type:r.ParameterType.FLOAT,default:null},rate:{type:r.ParameterType.FLOAT,default:1},trial_ends_after_video:{type:r.ParameterType.BOOL,default:!1},trial_duration:{type:r.ParameterType.INT,default:null},button_layout:{type:r.ParameterType.STRING,default:"grid"},grid_rows:{type:r.ParameterType.INT,default:1},grid_columns:{type:r.ParameterType.INT,default:null},response_ends_trial:{type:r.ParameterType.BOOL,default:!0},response_allowed_while_playing:{type:r.ParameterType.BOOL,default:!0},enable_button_after:{type:r.ParameterType.INT,default:0}},data:{response:{type:r.ParameterType.INT},rt:{type:r.ParameterType.INT},stimulus:{type:r.ParameterType.STRING,array:!0}},citations:{apa:"de Leeuw, J. R., Gilbert, R. A., & Luchterhandt, B. (2023). jsPsych: Enabling an Open-Source Collaborative Ecosystem of Behavioral Experiments. Journal of Open Source Software, 8(85), 5351. https://doi.org/10.21105/joss.05351 ",bibtex:'@article{Leeuw2023jsPsych, 	author = {de Leeuw, Joshua R. and Gilbert, Rebecca A. and Luchterhandt, Bj{\\" o}rn}, 	journal = {Journal of Open Source Software}, 	doi = {10.21105/joss.05351}, 	issn = {2475-9066}, 	number = {85}, 	year = {2023}, 	month = {may 11}, 	pages = {5351}, 	publisher = {Open Journals}, 	title = {jsPsych: Enabling an {Open}-{Source} {Collaborative} {Ecosystem} of {Behavioral} {Experiments}}, 	url = {https://joss.theoj.org/papers/10.21105/joss.05351}, 	volume = {8}, }  '}};class h{constructor(n){this.jsPsych=n}trial(n,t){const o=document.createElement("div");n.appendChild(o);const e=document.createElement("video");o.appendChild(e),e.id="jspsych-video-button-response-stimulus",t.width&&(e.width=t.width),t.height&&(e.height=t.height),e.controls=t.controls,e.autoplay=t.autoplay&&t.start==null,t.start!==null&&(e.style.visibility="hidden");const u=this.jsPsych.pluginAPI.getVideoBuffer(t.stimulus[0]);if(!u)for(let a of t.stimulus){a.indexOf("?")>-1&&(a=a.substring(0,a.indexOf("?")));const l=a.substring(a.lastIndexOf(".")+1).toLowerCase();l==="mov"&&console.warn("Warning: video-button-response plugin does not reliably support .mov files.");const i=document.createElement("source");i.src=a,i.type="video/"+l,e.appendChild(i)}const s=document.createElement("div");if(s.id="jspsych-video-button-response-btngroup",t.button_layout==="grid"){if(s.classList.add("jspsych-btn-group-grid"),t.grid_rows===null&&t.grid_columns===null)throw new Error("You cannot set `grid_rows` to `null` without providing a value for `grid_columns`.");const a=t.grid_columns===null?Math.ceil(t.choices.length/t.grid_rows):t.grid_columns,l=t.grid_rows===null?Math.ceil(t.choices.length/t.grid_columns):t.grid_rows;s.style.gridTemplateColumns=`repeat(${a}, 1fr)`,s.style.gridTemplateRows=`repeat(${l}, 1fr)`}else t.button_layout==="flex"&&s.classList.add("jspsych-btn-group-flex");for(const[a,l]of t.choices.entries()){s.insertAdjacentHTML("beforeend",t.button_html(l,a));const i=s.lastChild;i.dataset.choice=a.toString(),i.addEventListener("click",()=>{P(a)})}n.appendChild(s),t.prompt!==null&&n.insertAdjacentHTML("beforeend",t.prompt);var d=performance.now();u&&(e.src=u),e.onended=()=>{t.trial_ends_after_video?c():t.response_allowed_while_playing||m()},e.playbackRate=t.rate,t.start!==null&&(e.pause(),e.onseeked=()=>{e.style.visibility="visible",e.muted=!1,t.autoplay?e.play():e.pause(),e.onseeked=()=>{}},e.onplaying=()=>{e.currentTime=t.start,e.onplaying=()=>{}},e.muted=!0,e.play());let f=!1;t.stop!==null&&e.addEventListener("timeupdate",a=>{e.currentTime>=t.stop&&(t.response_allowed_while_playing||(t.enable_button_after>0?b(t.enable_button_after):m()),e.pause(),t.trial_ends_after_video&&!f&&(f=!0,c()))});const b=a=>{this.jsPsych.pluginAPI.setTimeout(m,a)};t.response_allowed_while_playing?(y(),t.enable_button_after>0?b(t.enable_button_after):m()):y();var p={rt:null,button:null};const c=()=>{e.pause(),e.onended=()=>{};const a={rt:p.rt,stimulus:t.stimulus,response:p.button};this.jsPsych.finishTrial(a)};function P(a){var l=performance.now(),i=Math.round(l-d);p.button=a,p.rt=i,e.classList.add("responded"),y(),t.response_ends_trial&&c()}function y(){for(const a of s.children)a.setAttribute("disabled","disabled")}function m(){for(const a of s.children)a.removeAttribute("disabled")}t.trial_duration!==null&&this.jsPsych.pluginAPI.setTimeout(c,t.trial_duration)}simulate(n,t,o,e){t=="data-only"&&(e(),this.simulate_data_only(n,o)),t=="visual"&&this.simulate_visual(n,o,e)}create_simulation_data(n,t){const o={stimulus:n.stimulus,rt:this.jsPsych.randomization.sampleExGaussian(500,50,.006666666666666667,!0)+n.enable_button_after,response:this.jsPsych.randomization.randomInt(0,n.choices.length-1)},e=this.jsPsych.pluginAPI.mergeSimulationData(o,t);return this.jsPsych.pluginAPI.ensureSimulationDataConsistency(n,e),e}simulate_data_only(n,t){const o=this.create_simulation_data(n,t);this.jsPsych.finishTrial(o)}simulate_visual(n,t,o){const e=this.create_simulation_data(n,t),u=this.jsPsych.getDisplayElement();this.trial(u,n),o();const s=u.querySelector("#jspsych-video-button-response-stimulus"),d=()=>{e.rt!==null&&this.jsPsych.pluginAPI.clickTarget(u.querySelector(`#jspsych-video-button-response-btngroup [data-choice="${e.response}"]`),e.rt)};n.response_allowed_while_playing?d():s.addEventListener("ended",d)}}return h.info=T,h}(jsPsychModule);
//# sourceMappingURL=https://unpkg.com/@jspsych/plugin-video-button-response@2.1.0/dist/index.browser.min.js.map
